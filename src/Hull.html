<html>
    <head>
        <script src="http://d3js.org/d3.v7.min.js"></script>
    </head>
    <button onclick="addHullFun()">按钮</button>
    <svg id="hullSvg" width="600" height="400"></svg>
    
    <body>
      
    <script>
var points=[
    [
        258.6817147026132,
        377.2915552487615
    ],
    [
        579.9020867961757,
        266.16991750415025
    ],
    [
        487.08129430056346,
        262.8479322802158
    ],
    [
        413.26678668699554,
        129.6944382014364
    ],
    [
        392.85538033891237,
        199.2859962492675
    ],
    [
        349.11463087752566,
        399.93523684605333
    ],
    [
        493.10966562498373,
        381.4400506866878
    ],
    [
        376.27322347306847,
        361.4963265476574
    ],
    [
        411.50675732231144,
        247.1741679328966
    ],
    [
        590.4327036703019,
        169.23785675665127
    ],
    [
        495.12020880565944,
        175.10312537593276
    ],
    [
        452.416920756672,
        351.5645508111113
    ],
    [
        275.1538527739577,
        279.1244242466009
    ],
    [
        590.2293524684474,
        259.9564074801184
    ],
    [
        294.67127740671964,
        69.92114275958068
    ],
    [
        439.1191831562452,
        146.0798254941622
    ],
    [
        235.68351139131354,
        200.52530840179256
    ],
    [
        343.33124023435005,
        128.48303899528207
    ],
    [
        390.7860592130281,
        68.31627230983815
    ],
    [
        270.50025796535147,
        210.4290820047182
    ],
    [
        593.1298092666632,
        231.59031861631405
    ],
    [
        502.5426859861094,
        70.11790497780854
    ],
    [
        225.37149512157424,
        325.3797525600256
    ],
    [
        582.9610546214428,
        12.777912362311554
    ],
    [
        332.34891221281157,
        398.5230299513472
    ],
    [
        524.1018614678851,
        48.5963883012314
    ],
    [
        508.58448077284663,
        356.4469002434922
    ],
    [
        529.6244999236818,
        388.6504098914383
    ],
    [
        455.7997637778815,
        65.93142892355868
    ],
    [
        340.9980848185873,
        167.72384842869758
    ],
    [
        302.9185427656634,
        372.2971779098806
    ],
    [
        523.1069714799703,
        332.8685274692461
    ],
    [
        558.1579191461742,
        115.39436765100169
    ],
    [
        590.7365634738073,
        134.98172537865844
    ],
    [
        354.14372025664795,
        50.43640777323466
    ],
    [
        461.0228120959489,
        223.83881651444318
    ],
    [
        243.22825927918504,
        106.2821280217486
    ],
    [
        486.46507652348413,
        214.11339752188158
    ],
    [
        407.36735069374583,
        309.392844392595
    ],
    [
        559.4550898588558,
        84.28393087035619
    ],
    [
        322.924033789491,
        274.81931938542186
    ],
    [
        378.7451147185813,
        348.37537164049365
    ],
    [
        595.9473381272527,
        6.472502241473876
    ],
    [
        243.77546793224315,
        239.415958617145
    ],
    [
        296.93526890647234,
        103.84912284528403
    ],
    [
        367.9366297939316,
        343.83186165911087
    ],
    [
        618.3094828355217,
        395.39956381947354
    ],
    [
        407.37374597360065,
        296.78307598169494
    ],
    [
        591.142392386459,
        170.37928608807178
    ],
    [
        268.75299489051696,
        108.08540391474288
    ],
    [
        491.94308071906835,
        75.90693715744888
    ],
    [
        326.6616377046114,
        94.67832122855269
    ],
    [
        296.65839755552884,
        349.8791597799889
    ],
    [
        231.25596795286998,
        88.73881748603063
    ],
    [
        311.464654085801,
        89.22110670024388
    ],
    [
        462.82233212523613,
        114.65200962798248
    ],
    [
        496.703944173514,
        290.85737992674774
    ],
    [
        514.9719181763624,
        158.23208769740376
    ],
    [
        374.8061631390185,
        201.94757078023918
    ],
    [
        603.3833158614002,
        2.375910333303551
    ],
    [
        422.46555107394147,
        59.10684385685386
    ],
    [
        242.56499003115349,
        175.04183520044353
    ],
    [
        470.61973014910126,
        71.8881489355388
    ],
    [
        443.10095032707727,
        251.25408244806601
    ],
    [
        358.0145684156705,
        293.64019885667074
    ],
    [
        260.8398037151636,
        82.8774732402107
    ],
    [
        411.7014661031698,
        342.47119858790916
    ],
    [
        605.2947301367885,
        348.07152470417486
    ],
    [
        545.805363361816,
        157.58783611629747
    ],
    [
        293.0652488572615,
        3.927054152215703
    ]
]

var line = d3.line()
        .x(d => d[0])
        .y(d => d[1])
        .curve(d3.curveCatmullRomClosed);
var hullResult = hull(points)
var hullPath = line(hullResult)
function hull(points) {
  // No sense in rendering a hull for fewer than two points
  // Comment by David -  Makes sense actually, if your client has such requirements for you
  if (points.length < 2)  return d3.polygonHull([points[0],points[0], ...points]);
  if (points.length < 3) return d3.polygonHull([points[0], ...points]);

  return d3.polygonHull(points);
}
  
function addHullFun(d){
    // 如果Hull透明度为0,加上
    console.log((d3.select("#pathKnow").attr("opacity"))==0)
    if( (d3.select("#pathKnow").attr("opacity"))==0 ){
            d3.select("#pathKnow").attr("opacity", 0.2)
            console.log("执行了");
    }
    // 已有Hull,去掉
    else{
        d3.select("#pathKnow").attr("opacity", 0)
    }
    
 
}
   
function dragged(d) {
    d3.select(this)
        .attr("cx", d[0] = d3.event.x)
        .attr("cy", d[1] = d3.event.y);
    
    path.attr("d", line(hull(svg.selectAll("circle").data())));
  }
  
  const svg = d3.select("#hullSvg").attr("width",800).attr("height",600);
       
   const path = svg.append("path")
   .attr("id","pathKnow")
      .attr("fill", "steelblue")
      .attr("stroke", "steelblue")
      .attr("stroke-width", 16)
      .attr("opacity", 0)
      .attr("d", hullPath);
 
  
  svg.selectAll("circle").data(points)
    .enter().append("circle")
      .style("cursor", "grab")
      .attr("fill", "steelblue")
      .attr("cx", d => d[0])
      .attr("cy", d => d[1])
      .attr("r", 14)
    .on("click",function(){
      console.log("点击了点")
    })
  


</script>
</body>
  